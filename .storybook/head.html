<div id="blabbr-version-history">
</div>

<script>
const versionHistoryLinks = document.getElementById('blabbr-version-history');
const path = window.parent.location.pathname;
const currentVersion = path.substr(1, path.length - 2);

const processVersions = data => {
  data.forEach((version) => {
    if (version === currentVersion) {
      // No link
      const el = ocument.createElement('strong');
      el.appendChild(document.createTextNode(version));
      versionHistoryLinks.appendChild(el);
    } else {
      // Link :-)
      const link = document.createElement('a');
      const url = window.parent.location;
      const versionUrl = `${url.protocol}//${url.hostname}:${url.port}/${version}/${url.search}${url.hash}`;

      link.href = versionUrl;
      link.target = '_parent';
      link.appendChild(document.createTextNode(version));

      versionHistoryLinks.appendChild(link);
    }
  });
}

const getVersions = () => {
  const url = window.parent.location;
  const location = `${url.protocol}//${url.hostname}:${url.port}/versions.json`;

  fetch(location).then(response => {
    if (response.ok) {
      response.json().then(data => processVersions(data));
    }
  }).catch(() => {
    // Ignore. Maybe we want to remove the div?
  });
}

getVersions();
</script>
<style>
  body {
    padding: 0;
    margin: 0;
  }

  #blabbr-version-history {
    background: rgb(247, 247, 247);
    border-bottom: 1px solid rgb(236, 236, 236);
    padding: 2px;
  }

  #blabbr-version-history > * {
    display: inline-block;
    padding: 0.3em;
    border: 1px solid grey;
    border-radius: 0.5em;
    margin: 0 0.5em;
  }

</style>
